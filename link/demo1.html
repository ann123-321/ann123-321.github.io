<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>正在開啟 App...</title>
    <style>
        #fallback {
            display: none;
            margin-top: 20px;
        }

        body {
            font-family: sans-serif;
            padding: 20px;
            text-align: center;
        }

        a.button {
            display: inline-block;
            margin: 10px;
            padding: 12px 20px;
            background-color: #007aff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <h1>正在嘗試開啟 App...</h1>
    <div id="fallback">
        <p>若未成功開啟 App，請選擇下載：</p>
        <a id="storeLink" class="button" href="#">前往下載</a>
    </div>

    <script>
        let pageHidden = false;

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                pageHidden = true;
            }
        });

        function tryOpenApp() {
            const ua = navigator.userAgent.toLowerCase();
            const isAndroid = ua.includes('android');
            const isiOS = /iphone|ipad|ipod/.test(ua);

            const schemeURL = 'com.ennowell.building-manager-client.com.dev://dashboard';
            const iosStore = 'https://apps.apple.com/us/app/%E6%A8%BA%E5%BA%B7e-life/id6743686610';
            const androidStore = 'https://play.google.com/apps/internaltest/4701656585058484161';
            const fallbackURL = isiOS ? iosStore : (isAndroid ? androidStore : '/');

            document.getElementById('storeLink').href = fallbackURL;

            window.location = schemeURL;

            setTimeout(() => {
                if (!pageHidden) {
                    document.getElementById('fallback').style.display = 'block';
                }
            }, 2200);
        }

        // 自動執行
        window.onload = tryOpenApp;
    </script>
</body>

</html>